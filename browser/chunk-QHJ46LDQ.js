import{E as m,a as l,c as g,m as p}from"./chunk-GM7AOBSF.js";import{C as s,T as c,Y as h,ab as f,p as r,q as u,t as n}from"./chunk-6Z747BRA.js";var $=(()=>{class a{get tokenSig(){return this.tokenSignal()}constructor(t,e){this.http=t,this.router=e,this.baseUrl=m.baseUrl,this.isLocalStorageAvailable=typeof localStorage<"u",this.token=null,this.tokenSignal=f(""),typeof window<"u"&&typeof window.localStorage<"u"&&this.loadToken()}loadToken(){this.token=localStorage.getItem("token"),this.tokenSignal.set(this.token)}login(t,e){let o=this.baseUrl+"/login";return this.http.post(o,{email:t,password:e}).pipe(n(i=>(this.saveLocalStorage(i),this.loadToken(),i)),s(i=>{let k=i.error.error||"Login failed";return u(()=>new Error(k))}))}saveLocalStorage(t){return t&&t.access_token?(localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),!0):!1}getUserAuth(){if(!this.isLocalStorageAvailable)return r(!1);let t=localStorage.getItem("token")??"";if(!t)return r(!1);let e=new l({Authorization:`Bearer ${t}`});return this.http.post(`${this.baseUrl}/auth/me`,{},{headers:e}).pipe(n(o=>o),s(()=>r(!1)))}me(){let t=new l({Authorization:`Bearer ${this.token}`});return this.http.post(`${this.baseUrl}/auth/me`,{},{headers:t})}changeStatusUser(t,e){let o=new l({Authorization:`Bearer ${this.token}`});return this.http.put(`${this.baseUrl}/auth/user/${t}/status`,{status:e},{headers:o}).pipe(n(i=>!!i),s(()=>r(!1)))}checkAuthentication(){if(!this.isLocalStorageAvailable)return r(!1);let t=localStorage.getItem("token")??"";if(!t)return r(!1);let e=new l({Authorization:`Bearer ${t}`});return this.http.post(`${this.baseUrl}/me`,{},{headers:e}).pipe(n(o=>!!o),s(()=>r(!1)))}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{this.router.navigateByUrl("/login")},500)}static{this.\u0275fac=function(e){return new(e||a)(h(g),h(p))}}static{this.\u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{$ as a};
