import{m as f}from"./chunk-PMR4NNHI.js";import{Rc as m,T as i,Y as u,ab as s,f as c,ya as h}from"./chunk-Z7LPJ5M7.js";var B=(()=>{class a{getBusinessName(){return this.businessName}constructor(e,t){this.router=e,this.platformId=t,this.cart=s([]),this.subtotalCart=s(0),this.businessName=null,this.encryptionKey="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",m(this.platformId)&&(this.loadBusinessNameFromUrl(),this.loadFromLocalStorage())}loadBusinessNameFromUrl(){let t=this.router.url.match(/store(?:\/product-explorer)?\/([^\/]+)/);t&&t[1]&&(this.businessName=t[1],console.log("Nombre del negocio capturado en el servicio:",this.businessName))}get subTotalCartSignal(){return this.subtotalCart}get cartSignal(){return this.cart}saveCartStorage(){return c(this,null,function*(){this.calcSubtotal();let e=JSON.stringify(this.cart()),t=yield this.encryptData(e);localStorage.setItem(this.getLocalStorageKey(),t)})}loadFromLocalStorage(){return c(this,null,function*(){let e=localStorage.getItem(this.getLocalStorageKey());if(!e)return;let t=yield this.decryptData(e);this.cart.set(JSON.parse(t)),this.calcSubtotal()})}getLocalStorageKey(){return`cart_${this.businessName}`}encryptData(e){return c(this,null,function*(){let r=new TextEncoder().encode(e),o=this.hexToBuffer(this.encryptionKey),l=yield crypto.subtle.importKey("raw",o,{name:"AES-GCM"},!1,["encrypt"]),n=window.crypto.getRandomValues(new Uint8Array(12)),d=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},l,r),y=new Uint8Array(d);return btoa(String.fromCharCode(...n,...y))})}decryptData(e){return c(this,null,function*(){let t=atob(e).split("").map(p=>p.charCodeAt(0)),r=new Uint8Array(t.slice(0,12)),o=new Uint8Array(t.slice(12)),l=this.hexToBuffer(this.encryptionKey),n=yield crypto.subtle.importKey("raw",l,{name:"AES-GCM"},!1,["decrypt"]),d=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},n,o);return new TextDecoder().decode(d)})}hexToBuffer(e){let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++)t[r]=parseInt(e.substr(r*2,2),16);return t}calcSubtotal(){let e=this.cart().reduce((r,o)=>r+o.totalAd,0),t=this.cart().reduce((r,o)=>r+o.totalCv*o.amount,0);this.subtotalCart.set(e+t)}static{this.\u0275fac=function(t){return new(t||a)(u(f),u(h))}}static{this.\u0275prov=i({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var U=(()=>{class a{get modalSignal(){return this.modal}get productSignal(){return this.product}constructor(){this.modal=s(!1),this.product=s({})}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=i({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{B as a,U as b};
